# Business Rules of The Hrönir Encyclopedia

This table defines the fundamental rules, principles, and constraints that govern The Hrönir Encyclopedia. These rules are the "laws of physics" for this narrative universe, ensuring its integrity, coherence, and ability to evolve. All participants, whether human contributors or automated agents, must operate within this framework.

### Content & Storage (The Hrönirs)

| ID    | Rule Name                  | Description                                                                                                                                                                                             |
| :---- | :------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| CS.1  | Hrönir Immutability & UUID | The canonical identifier for a hrön is a version 5 UUID, deterministically generated from the full, exact text content of its `index.md` file. Hrönirs are immutable.                                 |
| CS.2  | Canonical File Path        | Each hrön is stored in a unique directory path derived from its UUID. The path is constructed by using each character of the UUID as a subdirectory name (e.g., `the_library/d/9/4/4/...`).                  |
| CS.3  | Required Folder Contents   | Each hrön directory **must** contain an `index.md` file with the chapter's text and a `metadata.json` file.                                                                                             |
| CS.4  | Metadata Integrity         | The `metadata.json` file **must** contain a `uuid` field that exactly matches the content-derived UUID of the `index.md` file. It may also contain a `previous_uuid`.                                     |
| CS.5  | Hrönir Validity Conditions | A hrön is only valid if it exists at its correct UUID-derived path and its `metadata.json` `uuid` matches its content-derived UUID. Invalid hrönir are subject to automated purging.                   |

### Narrative Structure (The Forking Paths)

| ID    | Rule Name               | Description                                                                                                                                                                                     |
| :---- | :---------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| NS.1  | Path Definition         | Forking paths are defined in `.csv` files within the `forking_path/` directory. Each row represents a single fork and **must** contain `position`, `prev_uuid`, and `uuid`.                       |
| NS.2  | Fork UUID Generation    | Each forking path row **must** have a `fork_uuid` field, which is a version 5 UUID deterministically generated from the combined string of `position:prev_uuid:uuid`.                              |
| NS.3  | Forking Path Validity   | A forking path entry is only valid if its `fork_uuid` is correct and both its `prev_uuid` and `uuid` fields point to existing, valid hrönirs. Invalid entries are subject to automated purging.      |

### Selection & Canonization (Voting)

| ID    | Rule Name                      | Description                                                                                                                                                                                                                          |
| :---- | :----------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| SC.1  | Proof-of-Work for Voting       | Every vote **must** originate from a new row in `forking_path`. Creating this entry links valid hrönirs and yields a unique `fork_uuid` that acts as the voter identity and proof of work.
| SC.2  | Vote Record Structure          | Votes are recorded in `.csv` files within the `ratings/` directory. Each record **must** contain a unique `uuid` (for the vote itself), a `voter`, a `winner` (hrönir UUID), and a `loser` (hrönir UUID).                              |
| SC.3  | Voter Identity (Fork UUID)     | The `voter` field in a vote record **must** be the `fork_uuid` of a valid, existing forking path. A vote is cast "as" a specific narrative branch.                                                                                     |
| SC.4  | One Vote per Voter per Position| A single `voter` (`fork_uuid`) may only cast **one vote** per position. Subsequent votes from the same `fork_uuid` for the same position are invalid.                                                                                   |
| SC.5  | Vote Validity Conditions       | A vote is only valid if its `voter` is a valid `fork_uuid`, its `winner` and `loser` point to valid hrönirs, the voter has not already voted for that position, and the voted pair matches the duel curated by the system (see SC.7). Invalid votes are subject to automated purging. |
| SC.0  | Restrição de Linhagem Canônica | A competição para a Posição `N` é restrita exclusivamente aos `forks` cujo `prev_uuid` corresponde ao `hrönir_uuid` do `fork` canônico da Posição `N-1`.                                                                  |
| SC.6  | Canonização de Bifurcações em Cascata | A versão canônica do livro é um caminho de `forks` determinado periodicamente através do comando `consolidate-book`. Para cada posição, o `fork` com a maior pontuação Elo (entre os elegíveis pela linhagem canônica) é registrado em `data/canonical_path.json`. |
| SC.7  | Duelo de Máxima Entropia       | Todos os duelos são curados pelo sistema para resolver a maior incerteza no ranking entre `forks` elegíveis. O sistema sempre apresenta o par de `forks` que constitui o "Duelo de Máxima Entropia", calculado com base na proximidade de suas pontuações Elo. Votos só são aceitos para o duelo de `forks` curado ativo, obtido via `get-duel`. |
| **SC.8**  | **Direito de Julgamento Único e Causal** | A criação de um fork válido na Posição `N` concede ao seu criador o direito de iniciar **uma única** Sessão de Julgamento, dentro da qual ele pode proferir um veredito em qualquer subconjunto das posições anteriores (`N-1`, `N-2`, ..., `0`). O `fork_uuid` que serviu como mandado é consumido e não pode ser reutilizado.                                                                                                                                                                                                                         |
| **SC.9**  | **Dossiê Estático de Duelos**           | O início de uma sessão gera um dossiê estático e completo de todos os duelos de máxima entropia para as posições elegíveis, com base no estado canônico daquele momento. A interação do agente para proferir vereditos é feita contra este dossiê, não contra o estado ao vivo do sistema.                                                                                                                                                                                                                                                                   |
| **SC.10** | **Soberania da Curadoria do Sistema**   | Mesmo dentro de uma sessão de julgamento, o agente não pode escolher os competidores. Seu veredito é limitado a escolher um vencedor do par de forks apresentado pelo sistema no dossiê para cada posição.                                                                                                                                                                                                                                                                                                                                                   |
| **SC.11** | **Cascata Temporal como Único Consolidador** | O processo de determinação do caminho canônico é **sempre** uma cascata que se inicia a partir de um ponto no tempo. Este processo é acionado **exclusivamente** pelo `session commit` e começa na posição mais antiga que recebeu um veredito naquela sessão. Conceitos anteriores como `consolidate-book` periódico são obsoletos.                                                                                                                                                                                                    |
| **SC.12** | **Perenidade do Voto e Relevância Dinâmica** | Um voto, uma vez registrado no ledger, é imutável e permanente. Sua relevância para determinar o caminho canônico depende do estado atual da linha do tempo. Votos em linhagens não-canônicas ficam "adormecidos", mas são automaticamente "reativados" para influenciar o cálculo de Elo se a sua linhagem se tornar canônica novamente em algum momento futuro. |

### System & Ledger

| ID      | Rule Name                               | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| :------ | :-------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **SYS.1** | **Ledger Cronológico de Transações**    | Cada transação de votação (`session commit`) deve ser encapsulada em um bloco imutável. A identidade do bloco (`transaction_uuid`) é um UUIDv5 de seu conteúdo. Cada bloco deve conter o `transaction_uuid` do bloco imediatamente anterior, formando uma cadeia cronológica de eventos (blockchain) que garante a ordem e a integridade da história de votação.   |

### Generation & Contribution (Agents)

| ID    | Rule Name                      | Description                                                                                                                                                                                                                         |
| :---- | :----------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| GC.1  | Commit All Generated Artifacts | All generated content—including hrönirs, forking path entries, and votes created for any purpose (testing, PoW, etc.)—**must** be committed to the repository to ensure transparency and reproducibility.                               |
| GC.2  | Agent Compliance               | Automated agents (e.g., GitHub Actions) are bound by the same rules as human contributors.                                                                                                                                            |
| GC.3  | Automated System Cleaning      | The system **must** maintain its own integrity through automated cleaning processes. The `hronir-clean` pre-commit hook is a mandatory process that purges all invalid artifacts to keep the repository in a consistent and valid state. |
